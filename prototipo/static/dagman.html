<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="graph-creator.css" />
    <link rel="stylesheet" href="tesis.css" />    
  </head>

  <body>

<nav id="menu">
		<ul>
			<li id="id"></li>
			<li id="nombre"></li>
			<li >
				<h5>Ejecutable</h5>
				<select id="plantillaPrograma">
				</select>
			</li>
		</ul>
		<ul id="opciones">
			
		</ul>
</nav>

    <div id="toolbox">
      <input type="file" id="hidden-file-upload"><input id="upload-input" type="image" title="upload graph" src="upload-icon.png" alt="upload graph"> <input type="image" id="download-input" title="download graph" src="download-icon.png" alt="download graph"> <input type="image" id="delete-graph" title="delete graph" src="trash-icon.png" alt="delete graph"> 
    </div>

    <script src="//d3js.org/d3.v3.js" charset="utf-8"></script>    
    <script src="//cdn.jsdelivr.net/filesaver.js/0.1/FileSaver.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="graph-creator.js"></script>
    <script type="text/javascript" >
    		var plantillas = { 
    			ghc: { 
    			  programa: "ghc",
    			  useDocker: true,
    			  image : "haskell",
    			  args : [
      			    {parametro: "-keep-hc-file", tipo: "bool", valor: "false"},
    			    {parametro: "-keep-llvm-file", tipo: "text", valor: "ghc"},
    			    {parametro: "-XTemplateHaskell", tipo: "param", valor: false},
    			    {parametro: "--make", tipo: "param", valor: false},
    			    {parametro: "-XQuasiQuotes", tipo: "param", valor: false},
    			    {parametro: "file", tipo: "value", valor: ""}
    			  ]
    			},
    			happy : {
    			  programa: "happy",
    			  useDocker: true,
    			  image : "haskell",
    			  args : [
    			    {parametro: "programa", tipo: "ejecutable", valor: "happy"},
    			    {parametro: "-argumento", tipo: "param", valor: false},
    			    {parametro: "-g", tipo: "param", valor: false},
    			    {parametro: "--ghc", tipo: "param", valor: false},
    			    {parametro: "-XTemplateHaskell", tipo: "param", valor: false},
    			    {parametro: "file", tipo: "value", valor: "out"}
    			  ]
    			},
    			alex : {
    			  programa: "alex",
    			  useDocker: true,
    			  image : "haskell",
    			  args : [
    			    {parametro: "programa", tipo: "ejecutable", valor: "alex"},
    			    {parametro: "-d", tipo: "param", valor: false},
    			    {parametro: "--debug", tipo: "param", valor: false},
    			    {parametro: "-o", tipo: "param", valor: false},
    			    {parametro: "--outfile", tipo: "param", valor: false},
    			    {parametro: "file", tipo: "value", valor: ""},
    			  ]
    			},
    			cat: {
    			  programa: "cat",
    			  args : [
    			    {parametro: "programa", tipo: "ejecutable", valor: "cat"},
    			    {parametro: "-E", tipo: "param", valor: false},
    			    {parametro: "--show-ends", tipo: "param", valor: false},
    			    {parametro: "-n", tipo: "param", valor: false},
    			    {parametro: "--number", tipo: "param", valor: false},
    			    {parametro: "-XTemplateHaskell", tipo: "param", valor: false},
    			    {parametro: "file", tipo: "value", valor: ""},
    			  ]
    			},
    			sleep: {
    			  programa: "sleep",
    			  args : [
    			    {parametro: "programa", tipo: "ejecutable", valor: "sleep"},
    			    {parametro: "seconds", tipo: "value", valor: "5"},
    			  ]
    			}
    		};
			$('#plantillaPrograma').append($('<option>', { 
						value: "",
						text : "" 
			}));
    		for (var key in plantillas) {
   				if (plantillas.hasOwnProperty(key)) {
					$('#plantillaPrograma').append($('<option>', { 
						value: key,
						text : key 
					}));
   				}
   			}
			
			$("#opciones").on("change", function(e) {
				var target = e.target;
				var id = graph.state.selectedNode.id;
				
				var i=0; var encontrado = false;
				for(; i< graph.nodes[id].configurado.args.length; i++){
					var arg = graph.nodes[id].configurado.args[i];
					if(arg.parametro==target.name){
						encontrado = true;
						break;
					}
				}
				if(encontrado){
					if(target.files){
						graph.nodes[id].configurado.args[i].valor= target.files[0];
						console.dir(target);
						return ;
					}
					graph.nodes[id].configurado.args[i].valor= target.checked;
				}
			});
			
			
    		function rederizarArg(param){
	    		var opciones = $("#opciones");
    			switch(param.tipo){
    				case "ejecutable":
						break;
    				case "param":
    					if(param.valor)
    						opciones.append('<li> <input name="'+param.parametro+'" type="checkbox" checked>"'+ param.parametro +"</br>");
    					else
    						opciones.append('<li> <input name="'+param.parametro+'" type="checkbox">"'+ param.parametro +"</br>");
						break;
    				case "value":
						if(param.valor){
							opciones.append("<li> "+param.valor.name +" - "+param.valor.size +" <br/>");
							opciones.append('<input name="'+param.parametro+'" type="file">'+ param.parametro +"</input>");
						}
						else
							opciones.append('<li><input name="'+param.parametro+'" type="file">'+ param.parametro +"</input></li>");
						break;
    			}
    		}
    
    		function rederizarFormulario(nodo, buscado){
				if(!nodo.configurado)//nodo.configurado[buscado].programa != buscado)
    			{
    				nodo.configurado = jQuery.extend(true, {}, plantillas[buscado]);
	    		}else if(buscado != ""){
	    			nodo.configurado = jQuery.extend(true, {}, plantillas[buscado]);
	    		}
				$('#plantillaPrograma').val(nodo.configurado.programa);
	    		//$("#opciones").text(nodo.configurado.programa+"-"+nodo.configurado.veces);// JSON.stringify()
	    		nodo.configurado.args.forEach(rederizarArg);
				//console.dir(nodo.configurado);
    		}
    		
            $('#menu').click(function(event) {
            	var $box = $(event.target),
                boxName = $box.attr('class'),
                box = {
                    offset: $box.offset(),
                    pos: $box.position(),
                    normal: {
                        // excludes padding
                        width: $box.width(),
                        height: $box.height(),
                    },
                    inner: {
                        // includes padding
                        width: $box.innerWidth(), 
                        height: $box.innerHeight(),
                    },
                    outer: {
                        // includes border
                        width: $box.outerWidth(),
                        height: $box.outerHeight()
                    },
                    border: {
                        left: parseInt($box.css('border-left-width'), 10),
                        right: parseInt($box.css('border-right-width'), 10),
                        top: parseInt($box.css('border-top-width'), 10),
                        bottom: parseInt($box.css('border-bottom-width'), 10)
                    }
                };
                
            $.extend(box, {
                inner: {
                    top: box.offset.top + box.border.top,
                    left: box.offset.left + box.border.left,
                    right: box.offset.left + box.border.left + box.inner.width,
                    bottom: box.offset.top + box.border.top + box.inner.height
                }
            });
        
            $.extend(box, {
                inner: {
                    mouse: {
                        top: event.pageY - box.inner.top,
                        left: event.pageX - box.inner.left,
                        right: event.pageX - box.inner.right,
                        bottom: event.pageY - box.inner.bottom
                    }
                }
            });
            
            if (event.type == 'click') {
                if (box.inner.mouse.top > 0 &&
                    box.inner.mouse.left > 0 &&
                    box.inner.mouse.right < 0 &&
                    box.inner.mouse.bottom < 0) {
                    
                    
                } else {
					var menu = document.getElementById("menu");
					if (menu.style.right == "0px")
						menu.style.right = "-16em";					  	
					else
						menu.style.right = "0px";
                }
            }
            });
        </script>
  </body>

</html>
